{% extends "base.html" %}

{% block content %}
<div id="dialog" title="Form submission">
    <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 0 0;"></span>Please ensure that your payment has been processed and wait for a few moments for your music to download within PAYPAL. Do not click on the redirected within 10seconds link as we will not be held responsible for music which has not downloaded.</p>
</div>
<table summary="Your Shopping Cart" id="shopping_cart">
		<caption>YOUR SHOPPING CART</caption>
		<thead>
			<tr>
				<th class="first_th" scope="col">Song</th>
				<th class="first_th" scope="col">Price</th>
				<th class="first_th" scrope="col">Action</th>
			</tr>
		</thead>
		<tfoot>
			<tr>
				<th class="right" colspan="2">
					Cart Subtotal:
				</th>
				<th class="right" style="text-align:right;">
					£{{ basket_subtotal }}
				</th>
			</tr>
			<tr>
				<th colspan="10" style="text-align:right">
                    {{ form }}
              <br> 
				</th>
			</tr>
		</tfoot>
		{% if basket_items %}
		{% for song in basket_items %}
		<tbody>
				<tr>
					<td>
							{{ song.name }}
					</td>
					<td>£{{ song.price|floatformat:2}}</td>
					<td style="text-align:right;">
					<form method="post" action="." class="cart">{% csrf_token %}
						<input type="hidden" name="song_id" value="{{ song.id }}"/>
						<input class="remove" type="submit" name="submit" value="Remove" />
					</form>
				</tr>
            
            
		</tbody>
		{% endfor %}
		{% endif %}
	</table>
    <div class="attention"><span style="font-weight:bold">Attention:</span> while awaiting your payment to process please wait a few moments for your account to be verified. Please avoid the click "If you are not redirected within 10 seconds"</div>
    <br/>
    <br/>
    <br/>
    <br/>
{% endblock %}
{% block javascript %}
<script>
$("#dialog").dialog({
    resizable: false,
    autoOpen: false,
    modal: true,
    buttons: {
        "Yes": function() {
            $('#paypal').unbind("submit.mine").submit();
            $(this).dialog("close");
        },
        "No": function() {
            $(this).dialog("close");
        }
    }
});

$('#paypal').bind("submit.mine", function(event) {
    event.preventDefault();
    targetform = this;
    $('#dialog').dialog('open');
});
</script>

{% endblock %}
